<article>
    <header>Reading Practice</header>
    <div id="reading-practice-form">
        <div>

            <label for="line-count">Number of lines:</label>
            <input type="number" id="line-count" name="line-count" min="1" max="100" value="25">
        </div>
        <div>

            <label for="number-of-words-per-line">Number of Words Per Line</label>
            <input type="number" id="number-of-words-per-line" name="number-of-words-per-line" min="1" max="21"
                value="3">
        </div>
        <button type="submit" id="reading-practice-generate-button">Generate</button>
    </div>
    <main id="reading-practice">
    </main>
</article>

<script type="module">
    "use strict";

    /**
     * Loads a list of words from a text file and displays them in the specified HTML element.
     *
     * @param {string} id - The ID of the HTML element where the words will be displayed.
     * @param {number} numberOfLines - The number of lines to display.
     * @param {number} numberOfWordsPerLine - The number of words to display per line.
     * @returns {Promise<void>} A promise that resolves when the words are loaded and displayed.
     */
    export const loadWords = async (id, numberOfLines, numberOfWordsPerLine) => {
        const mainElement = document.getElementById(id);
        if (!mainElement) {
            console.error(`Element with ID ${id} not found.`);
            return;
        }
        console.log("Loading words...");
        // Fetch the words from the text file
        const response = await fetch("/static/assets/1000-words.txt");
        const data = await response.text();

        const words = data
            .split("\n")
            .map((word) => word.trim())
            .filter((word) => word.length > 0);
        console.log(words);

        const div = document.createElement("div");
        div.classList.add("light");
        for (let i = 0; i < numberOfLines; i++) {
            const p = document.createElement("p");
            const wordsInLine = [];
            for (let j = 0; j < numberOfWordsPerLine; j++) {
                const randomWordIndex = randomNumber(0, words.length - 1);
                wordsInLine.push(words[randomWordIndex]);
            }
            p.textContent = wordsInLine.join(" ");
            p.classList.add("line");

            div.appendChild(p);
        }

        mainElement.innerHTML = ""; // Clear the main element
        mainElement.appendChild(div);
        console.log("Words loaded and displayed.");
    };

    const randomNumber = (min, max) => {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    };

    const doWords = async () => {
        const lineCount = document.getElementById("line-count").value;
        const numberOfWordsPerLine = document.getElementById("number-of-words-per-line").value;

        await loadWords("reading-practice", lineCount, numberOfWordsPerLine);
    };


    const submitButton = document.getElementById("reading-practice-generate-button");

    submitButton.addEventListener("click", async (event) => {
        event.preventDefault();
        await doWords();
    });
</script>